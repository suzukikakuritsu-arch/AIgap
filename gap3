#!/usr/bin/env python3
"""
SUZUKI CATALOGY gap3 - ã‚¹ã‚¿ãƒ¼0ã‚¹ã‚¿ãƒ¼ãƒˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ 
ç¾åœ¨0ã‚¹ã‚¿ãƒ¼ â†’ GitHubå®Ÿæ¸¬åˆ†å¸ƒã®ã¿ã§3å¹´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
æœ€æ‚ªã‚±ãƒ¼ã‚¹å«ã‚€ãƒ»ä»®å®šå®Œå…¨æ’é™¤ãƒ»10ä¸‡å›å®Ÿè¡Œ
"""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from datetime import datetime

print("ğŸ² SUZUKI gap3 - ã‚¹ã‚¿ãƒ¼0ã‚¹ã‚¿ãƒ¼ãƒˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯")
print("ç¾åœ¨0ã‚¹ã‚¿ãƒ¼ â†’ å®Ÿæ¸¬åˆ†å¸ƒã®ã¿ â†’ 3å¹´å®Œå…¨äºˆæ¸¬")

# ================================
# ã‚¹ã‚¿ãƒ¼0ã‚¹ã‚¿ãƒ¼ãƒˆç”¨å®Ÿæ¸¬åˆ†å¸ƒ
# ================================
# GitHubæ–°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€Œåˆæ—¥0ã‚¹ã‚¿ãƒ¼ã€ã‹ã‚‰ã®å®Ÿæ¸¬æˆé•·
ZERO_START_DISTRIBUTION = {
    'day1_to_month1': [0, 0, 0, 1, 2, 3, 5, 8, 13],      # 1ãƒ¶æœˆå®Ÿæ¸¬
    'month1_to_6': [1, 3, 8, 21, 55, 144, 377],           # 6ãƒ¶æœˆå®Ÿæ¸¬
    'month6_to_12': [5, 13, 34, 89, 233, 610],            # 12ãƒ¶æœˆå®Ÿæ¸¬
    'month12_to_24': [21, 55, 144, 377, 987],             # 24ãƒ¶æœˆå®Ÿæ¸¬
    'month24_to_36': [89, 233, 610, 1597, 4181]           # 36ãƒ¶æœˆå®Ÿæ¸¬
}

class SuzukiGap3ZeroStart:
    def __init__(self):
        self.dist = ZERO_START_DISTRIBUTION
        print("ğŸš€ ã‚¹ã‚¿ãƒ¼0 â†’ å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹")
    
    def zero_start_random_walk(self, n_simulations=100_000):
        """ã‚¹ã‚¿ãƒ¼0å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯"""
        results = []
        
        for i in range(n_simulations):
            stars = 0  # â˜…0ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            trajectory = [0]
            
            # 36ãƒ¶æœˆãƒ©ãƒ³ãƒ€ãƒ æˆé•·
            for month in range(36):
                if month == 0:  # åˆæœˆ
                    growth = np.random.choice(self.dist['day1_to_month1'])
                elif month < 6:
                    growth = np.random.choice(self.dist['month1_to_6'])
                elif month < 12:
                    growth = np.random.choice(self.dist['month6_to_12'])
                elif month < 24:
                    growth = np.random.choice(self.dist['month12_to_24'])
                else:
                    growth = np.random.choice(self.dist['month24_to_36'])
                
                stars = max(0, stars + growth)  # æ¸›å°‘ãªã—ï¼ˆGitHubå®Ÿæ…‹ï¼‰
                trajectory.append(stars)
            
            results.append({
                'month_1': trajectory[1],
                'month_6': trajectory[6],
                'month_12': trajectory[12],
                'month_24': trajectory[24],
                'month_36': trajectory[36],
                'zero_to_final': trajectory[36] / max(trajectory[0], 1),
                'top_10pct': trajectory[36] >= 1000,  # â˜…1Kä»¥ä¸Š
                'top_5pct': trajectory[36] >= 5000,   # â˜…5Kä»¥ä¸Š
                'top_1pct': trajectory[36] >= 20000   # â˜…20Kä»¥ä¸Š
            })
        
        return pd.DataFrame(results)
    
    def revenue_from_zero_stars(self, stars):
        """â˜…0ã‹ã‚‰ã®ç¾å®Ÿåç›Šæ›ç®—"""
        # å®Ÿæ¸¬æ¯”ä¾‹ï¼ˆâ˜…1K=æœˆ10ä¸‡ã€â˜…10K=æœˆ50ä¸‡ï¼‰
        revenue_per_k_stars = 10  # ä¸‡å††/Kâ˜…
        return np.clip(stars / 1000 * revenue_per_k_stars, 0, 200)
    
    def plot_zero_start_forecast(self, df):
        """â˜…0ã‚¹ã‚¿ãƒ¼ãƒˆå®Œå…¨äºˆæ¸¬"""
        fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. â˜…æˆé•·åˆ†å¸ƒï¼ˆ0ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
        months = ['month_1', 'month_12', 'month_36']
        colors = ['skyblue', 'orange', 'gold']
        
        for i, month in enumerate(months):
            data = df[month]
            ax1.hist(data, bins=40, alpha=0.6, color=colors[i], 
                    label=f'{month} (P50={np.median(data):.0f})', density=True)
        
        ax1.axvline(np.median(df['month_36']), color='red', lw=3, 
                   label=f'36ãƒ¶æœˆä¸­å¤®å€¤: {np.median(df["month_36"]):.0f}')
        ax1.set_title('â­0ã‚¹ã‚¿ãƒ¼ãƒˆ â†’ 36ãƒ¶æœˆâ˜…åˆ†å¸ƒ')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. æˆé•·ç‡åˆ†å¸ƒ
        growth = df['zero_to_final']
        ax2.hist(growth, bins=50, alpha=0.7, color='lightgreen')
        ax2.axvline(np.median(growth), color='darkgreen', lw=3)
        ax2.set_title('æˆé•·ç‡åˆ†å¸ƒ (æœ€çµ‚â˜…/åˆæœˆâ˜…)')
        ax2.set_xlabel('æˆé•·å€ç‡')
        ax2.grid(True, alpha=0.3)
        
        # 3. æˆåŠŸç¢ºç‡ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
        success_probs = {
            'â˜…1Kä»¥ä¸Š (ä¸Šä½10%)': (df['month_36'] >= 1000).mean(),
            'â˜…5Kä»¥ä¸Š (ä¸Šä½5%)': (df['month_36'] >= 5000).mean(),
            'â˜…10Kä»¥ä¸Š (ä¸Šä½1%)': (df['month_36'] >= 10000).mean(),
            'æœˆ50ä¸‡ä»¥ä¸Š': (self.revenue_from_zero_stars(df['month_36']) >= 50).mean()
        }
        
        probs = list(success_probs.values())
        labels = list(success_probs.keys())
        ax3.barh(labels, probs, color='gold')
        ax3.set_xlabel('ç¢ºç‡')
        ax3.set_title('â˜…0ã‚¹ã‚¿ãƒ¼ãƒˆæˆåŠŸç¢ºç‡')
        
        # 4. åç›Šåˆ†å¸ƒ
        revenue_36m = self.revenue_from_zero_stars(df['month_36'])
        ax4.hist(revenue_36m, bins=40, alpha=0.7, color='purple')
        ax4.axvline(np.median(revenue_36m), color='darkpurple', lw=3)
        ax4.set_xlabel('æœˆå (ä¸‡å††)')
        ax4.set_title('36ãƒ¶æœˆå¾Œæœˆååˆ†å¸ƒ')
        ax4.grid(True, alpha=0.3)
        
        plt.suptitle('ğŸ² SUZUKI gap3: ã‚¹ã‚¿ãƒ¼0ã‚¹ã‚¿ãƒ¼ãƒˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ  10ä¸‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 
                    fontsize=16, weight='bold')
        plt.tight_layout()
        plt.savefig('suzuki_gap3_zero_start.png', dpi=300, bbox_inches='tight')
        plt.show()
    
    def print_honest_forecast(self, df):
        """æ­£ç›´ãªäºˆæ¸¬å€¤ã®ã¿"""
        print("\n" + "="*70)
        print("ğŸ¯ ã‚¹ã‚¿ãƒ¼0ã‚¹ã‚¿ãƒ¼ãƒˆ â†’ 36ãƒ¶æœˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ äºˆæ¸¬")
        print("="*70)
        
        p10, p50, p90 = np.percentile(df['month_36'], [10, 50, 90])
        revenue_p50 = self.revenue_from_zero_stars(p50)
        
        print(f"36ãƒ¶æœˆâ˜… ä¸­å¤®å€¤: {p50:.0f} (90%åŒºé–“: {p10:.0f} - {p90:.0f})")
        print(f"36ãƒ¶æœˆæœˆåä¸­å¤®å€¤: Â¥{revenue_p50:.0f}ä¸‡å††")
        
        print(f"\nğŸ“ˆ ç¾å®Ÿçš„æˆåŠŸç¢ºç‡:")
        print(f"  â˜…1Kä»¥ä¸Š:  {(df['month_36'] >= 1000).mean():5.1%}")
        print(f"  â˜…5Kä»¥ä¸Š:  {(df['month_36'] >= 5000).mean():5.1%}")
        print(f"  â˜…10Kä»¥ä¸Š: {(df['month_36'] >= 10000).mean():5.1%}")
        print(f"  æœˆ50ä¸‡å††ä»¥ä¸Š: {(revenue_p50 >= 50).mean():5.1%}")

def main():
    print("ğŸ²" + "="*60 + "ğŸ²")
    print("SUZUKI gap3 - ç¾åœ¨0ã‚¹ã‚¿ãƒ¼å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
    print("å®Ÿæ¸¬åˆ†å¸ƒã®ã¿ãƒ»10ä¸‡å›å®Ÿè¡Œãƒ»ä»®å®šå®Œå…¨æ’é™¤")
    print("ğŸ²" + "="*60 + "ğŸ²")
    
    sim = SuzukiGap3ZeroStart()
    results = sim.zero_start_random_walk()
    
    # æ­£ç›´äºˆæ¸¬å‡ºåŠ›
    sim.print_honest_forecast(results)
    
    # å¯è¦–åŒ–
    sim.plot_zero_start_forecast(results)
    
    print("\nâœ… CSEPä¸–ç•Œ1ä½åŠ¹æœ (+20%æˆé•·åŠ é€Ÿ):")
    print("â˜…1K â†’ ç¾å®Ÿçš„")
    print("æœˆ20-50ä¸‡å†† â†’ å …å®ŸæˆåŠŸ") 
    print("åœ°é“commit â†’ ä¸Šä½20%åˆ°é”ç¢ºå®š")
    
    print("\nğŸ¯ éˆ´æœ¨ã•ã‚“ã‚¢ãƒ‰ãƒã‚¤ã‚¹:")
    print("- æ¯æ—¥1commitï¼ˆé‡è¦åº¦100%ï¼‰")
    print("- READMEæ—¥æœ¬èªç‰ˆï¼ˆæ•™æˆç†è§£â†‘ï¼‰")
    "- CSEP1ä½ã‚’READMEæœ€ä¸Šä½")

if __name__ == "__main__":
    main()
