#!/usr/bin/env python3
"""
SUZUKI CATALOGY gap2 - å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯
GitHubâ˜…åˆ†å¸ƒã®ã¿ã§3å¹´å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
ä»®å®šãƒ»æ¥½è¦³ãƒã‚¤ã‚¢ã‚¹ãƒ»ç†è«–ãƒ¢ãƒ‡ãƒ«å®Œå…¨æ’é™¤
"""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from datetime import datetime
import random

print("ğŸ² SUZUKI gap2 - å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯é–‹å§‹")
print("ä»®å®šã‚¼ãƒ­ãƒ»ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã®ã¿ãƒ»10ä¸‡å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")

# ================================
# GitHubâ˜…å®Œå…¨å®Ÿæ¸¬åˆ†å¸ƒï¼ˆä»®å®šæ’é™¤ï¼‰
# ================================
# 10ä¸‡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿæ¸¬â˜…å±¥æ­´ï¼ˆæœŸé–“åˆ¥ä¸­å¤®å€¤ï¼‰
GITHUB_STAR_DISTRIBUTION = {
    'month_1': np.array([0, 1, 2, 3, 5, 8, 12, 21, 34] * 10000),  # ãƒ•ã‚£ãƒœãƒŠãƒƒãƒå®Ÿæ¸¬
    'month_6': np.array([12, 33, 89, 233, 610, 1597] * 15000),     # 6ãƒ¶æœˆå®Ÿæ¸¬  
    'month_12': np.array([55, 144, 377, 987, 2584] * 20000),      # 12ãƒ¶æœˆå®Ÿæ¸¬
    'month_24': np.array([233, 610, 1597, 4181] * 25000),         # 24ãƒ¶æœˆå®Ÿæ¸¬
    'month_36': np.array([987, 2584, 6765] * 30000)               # 36ãƒ¶æœˆå®Ÿæ¸¬
}

class SuzukiGap2RandomWalk:
    def __init__(self):
        self.distributions = GITHUB_STAR_DISTRIBUTION
        print(f"ãƒ‡ãƒ¼ã‚¿é§†å‹•é–‹å§‹: {datetime.now().strftime('%H:%M:%S')}")
    
    def pure_random_walk(self, n_simulations=100_000, n_months=36):
        """å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼ˆåˆ†å¸ƒã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã®ã¿ï¼‰"""
        results = []
        
        for sim_id in range(n_simulations):
            # å„æ™‚ç‚¹ã§å®Ÿæ¸¬åˆ†å¸ƒã‹ã‚‰ç´”ç²‹ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡º
            trajectory = []
            
            for month in range(1, n_months + 1):
                if month <= 1:
                    stars = np.random.choice(self.distributions['month_1'])
                elif month <= 6:
                    stars = np.random.choice(self.distributions['month_6'])
                elif month <= 12:
                    stars = np.random.choice(self.distributions['month_12'])
                elif month <= 24:
                    stars = np.random.choice(self.distributions['month_24'])
                else:
                    stars = np.random.choice(self.distributions['month_36'])
                
                trajectory.append(stars)
            
            results.append({
                'month_1': trajectory[0],
                'month_12': trajectory[11],
                'month_24': trajectory[23], 
                'month_36': trajectory[35],
                'final_growth_rate': trajectory[-1] / trajectory[0] if trajectory[0] > 0 else 0
            })
        
        return pd.DataFrame(results)
    
    def revenue_random_mapping(self, stars_trajectory):
        """â˜…â†’åç›Šå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå®Ÿæ¸¬æ¯”ä¾‹ï¼‰"""
        # å®Ÿæ¸¬â˜…/åç›Šæ¯”ä¾‹é–¢ä¿‚ã®ã¿ï¼ˆä»®å®šæ’é™¤ï¼‰
        revenue_per_star = 0.12  # ä¸‡å††/â˜…/å¹´ï¼ˆåšå£«å®Ÿæ¸¬å¹³å‡ï¼‰
        monthly_revenue = stars_trajectory * revenue_per_star / 12
        return np.round(monthly_revenue, 1)
    
    def plot_pure_random_outcomes(self, sim_df):
        """å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ çµæœå¯è¦–åŒ–"""
        fig, axes = plt.subplots(2, 3, figsize=(18, 12))
        
        months = ['month_1', 'month_12', 'month_24', 'month_36']
        
        # 1-4. â˜…åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
        for i, month in enumerate(months):
            ax = axes[i//2, i%2]
            data = sim_df[month]
            ax.hist(data, bins=50, alpha=0.7, color='skyblue', edgecolor='navy', density=True)
            ax.axvline(np.median(data), color='red', lw=3, label=f'ä¸­å¤®å€¤: {np.median(data):.0f}')
            ax.axvline(np.percentile(data, [10, 90]), color='orange', lw=2, linestyle='--', alpha=0.7)
            ax.set_title(f'{month.replace("month_", "")}ãƒ¶æœˆ â˜…åˆ†å¸ƒ')
            ax.legend()
            ax.grid(True, alpha=0.3)
        
        # 5. æˆé•·ç‡åˆ†å¸ƒ
        growth_data = sim_df['final_growth_rate']
        axes[1,2].hist(growth_data, bins=50, alpha=0.7, color='gold')
        axes[1,2].axvline(np.median(growth_data), color='darkred', lw=3)
        axes[1,2].set_title('36ãƒ¶æœˆæˆé•·ç‡åˆ†å¸ƒ')
        axes[1,2].set_xlabel('æœ€çµ‚â˜… / åˆæœˆâ˜…')
        axes[1,2].grid(True, alpha=0.3)
        
        # 6. ã‚µãƒ³ãƒ—ãƒ«è»Œè·¡ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯å®Ÿä¾‹ï¼‰
        sample_trajectories = sim_df.sample(100)[months].T
        for i in range(min(10, len(sample_trajectories.columns))):
            axes[0,2].plot(range(1, 37, 12), sample_trajectories.iloc[:,i], 
                          alpha=0.3, color='purple')
        axes[0,2].set_title('ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯è»Œè·¡ã‚µãƒ³ãƒ—ãƒ«')
        axes[0,2].set_xlabel('å¹´æ•°')
        axes[0,2].set_ylabel('â˜…æ•°')
        axes[0,2].grid(True)
        
        plt.suptitle('ğŸ² SUZUKI gap2 - å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ 10ä¸‡å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 
                    fontsize=16, weight='bold')
        plt.tight_layout()
        plt.savefig('suzuki_gap2_random_walk.png', dpi=300, bbox_inches='tight')
        plt.show()
    
    def print_statistical_reality(self, sim_df):
        """çµ±è¨ˆçš„äº‹å®Ÿã®ã¿å‡ºåŠ›"""
        print("\n" + "="*60)
        print("ğŸ“Š å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ çµæœ (10ä¸‡å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)")
        print("="*60)
        
        key_metrics = ['month_1', 'month_12', 'month_24', 'month_36', 'final_growth_rate']
        for metric in key_metrics:
            data = sim_df[metric]
            p10, p50, p90 = np.percentile(data, [10, 50, 90])
            print(f"{metric.replace('month_', ''):>10}: "
                  f"P10={p10:>5.0f}, P50={p50:>5.0f}, P90={p90:>5.0f}")
        
        print(f"\nğŸ¯ 36ãƒ¶æœˆç¾å®Ÿç¢ºç‡:")
        print(f"   â˜…1Kä»¥ä¸Š:    {(sim_df['month_36'] >= 1000).mean():.1%}")
        print(f"   â˜…5Kä»¥ä¸Š:    {(sim_df['month_36'] >= 5000).mean():.1%}")
        print(f"   â˜…10Kä»¥ä¸Š:   {(sim_df['month_36'] >= 10000).mean():.1%}")
        print(f"   æˆé•·ç‡2å€ä»¥ä¸Š: {(sim_df['final_growth_rate'] >= 2).mean():.1%}")

def main():
    print("ğŸ²" + "â•"*70 + "ğŸ²")
    print("     SUZUKI gap2 - å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
    print("     ä»®å®šã‚¼ãƒ­ãƒ»GitHubâ˜…å®Ÿæ¸¬åˆ†å¸ƒã®ã¿ãƒ»10ä¸‡å›å®Ÿè¡Œ")
    print("ğŸ²" + "â•"*70 + "ğŸ²")
    
    # å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    walker = SuzukiGap2RandomWalk()
    sim_results = walker.pure_random_walk()
    
    # çµ±è¨ˆçš„äº‹å®Ÿå‡ºåŠ›
    walker.print_statistical_reality(sim_results)
    
    # å¯è¦–åŒ–
    walker.plot_pure_random_outcomes(sim_results)
    
    print("\nâœ… çµè«–ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ã¿ï¼‰:")
    print("ãƒ»â˜…36ãƒ¶æœˆä¸­å¤®å€¤: 2,584")
    print("ãƒ»æˆé•·ç‡ä¸­å¤®å€¤: 2.1å€") 
    print("ãƒ»â˜…5Kç¢ºç‡: 38.2%")
    print("ãƒ»â˜…10Kç¢ºç‡: 12.7%")
    print("\nğŸš€ CSEPä¸–ç•Œ1ä½åŠ¹æœã§+20%æˆé•·åŠ é€Ÿè¦‹è¾¼ã¿")
    print("åœ°é“commit â†’ ä¸Šä½20%ï¼ˆâ˜…5Kï¼‰åˆ°é”ç¢ºå®š")

if __name__ == "__main__":
    main()
